<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo React Page Div</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css" rel="stylesheet"/>

    <script src="https://fb.me/react-0.14.7.js"></script>
    <script src="https://fb.me/react-dom-0.14.7.js"></script>

    <script src="dist/ReactPageDiv.js"></script>

    <style>
        .container {
            margin: 10px auto;
            width: 768px;
        }

        @media (max-width: 768px) {
            .container {
                width: 100%;
            }

        }

        .page {
            margin: 10px auto;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
        }

        @media print {
            .hidden-print {
                display: none;
            }

            .page {
                margin: 0;
                box-shadow: none;
            }
        }

        .flex-column {
            display: flex;
            display: -webkit-flex;
            flex-flow: column nowrap;
            -webkit-flex-flow: column nowrap;
        }

        .min-height-100 {
            min-height: 100%;
        }

        .min-height-0 {
            min-height: 0;
        }

        .no-flex {
            flex: none;
            -webkit-flex: none;
        }

        .flex-row {
            display: flex;
            display: -webkit-flex;
            flex-flow: row nowrap;
            -webkit-flex-flow: row nowrap;
        }

        .flex-grow {
            flex: 1 0;
            -webkit-flex: 1 0;
        }

        .flex-50 {
            flex: 1 1 50%;
            -webkit-flex: 1 1 50%;
        }
    </style>
</head>
<body>

<div id="demo"></div>

<script>
    var rpd = React.createFactory(ReactPageDiv),
            d = React.DOM;

    var AutoResizeTextArea = React.createFactory(React.createClass({
        displayName: 'Autoresizing TextArea',

        propTypes: {
            height: React.PropTypes.number.isRequired,
            onChangeHeight: React.PropTypes.func.isRequired
        },

        getDefaultProps: function () {
            return {
                height: 0
            };
        },

        componentDidMount: function () {
            this.calculateHeight();
        },

        componentDidUpdate: function () {
            this.calculateHeight();
        },

        calculateHeight: function () {
            const hiddenScrollHeight = this.refs.hidden.scrollHeight;
            if (typeof hiddenScrollHeight !== 'number') {
                return;
            }
            if (hiddenScrollHeight !== this.props.height) {
                this.props.onChangeHeight(hiddenScrollHeight);
            }
        },

        render: function () {
            return React.DOM.span({}, [
                // render the same textarea twice, once with no height
                React.DOM.textarea(Object.assign({}, this.props, {
                    key: 'visible',
                    style: Object.assign({}, this.props.style, { resize: 'none', height: this.props.height })
                })),

                React.DOM.textarea(Object.assign({}, this.props, {
                    key: 'hidden',
                    ref: 'hidden',
                    // used only to calculate the height of the input
                    style: Object.assign({}, this.props.style, {
                        resize: 'none', visibility: 'hidden', position: 'absolute', height: 0
                    })
                }))
            ]);
        }
    }));

    var PageDemo = React.createClass({
        displayName: 'Page Demo',

        getInitialState: function () {
            return {
                height: 100,
                textarea: '',
                textareaHeight: 10
            };
        },

        handleChange: function (e) {
            this.setState({ textarea: e.target.value });
        },
        handleChangeHeight: function (height) {
            this.setState({ textareaHeight: height });
        },

        getPages: function () {
            return rpd({
                className: 'page',
                width: this.props.pageWidth,
                widthUnit: 'in',
                height: this.props.pageHeight,
                heightUnit: 'in',
                dpi: this.props.dpi,
                pageMarkerClassName: 'hidden-print'
            }, d.div({
                className: 'flex-column min-height-100'
            }, [
                d.h1({
                    key: 1,
                    className: 'no-flex'
                }, 'Heading 1'),

                d.div({
                    key: 2,
                    className: 'min-height-0 flex-grow',
                    style: {
                        backgroundColor: 'red'
                    }
                }, [
                    d.div({ key: 1, style: { minHeight: this.state.height, backgroundColor: 'pink' } }, 'hello'),
                    AutoResizeTextArea({
                        key: 'textarea',
                        value: this.state.textarea, onChange: this.handleChange, minHeight: 100, style: {
                            backgroundColor: 'transparent',
                            outline: 'none',
                            border: 'none',
                            width: '100%'
                        },
                        height: this.state.textareaHeight,
                        onChangeHeight: this.handleChangeHeight
                    })
                ]),

                d.div({
                    key: 3,
                    className: 'no-flex flex-row',
                    style: {
                        backgroundColor: 'yellow'
                    }
                }, [
                    d.div({ key: 1, className: 'flex-50' }, d.table({}, [
                        d.thead({ key: 1 }, d.tr({}, [ d.th({ key: 1 }, 'Hello'), d.th({ key: 2 }, 'World') ])),
                        d.tbody({ key: 2 }, [
                            d.tr({ key: 1 }, [ d.td({ key: 1 }, 'Table'), d.td({ key: 2 }, 'Data') ])
                        ])
                    ])),
                    d.div({ key: 2, className: 'flex-50' }, d.table({}, [
                        d.thead({ key: 1 }, d.tr({}, [ d.th({ key: 1 }, 'Hello'), d.th({ key: 2 }, 'World') ])),
                        d.tbody({ key: 2 }, [
                            d.tr({ key: 1 }, [ d.td({ key: 1 }, 'Table'), d.td({ key: 2 }, 'Data') ]),
                            d.tr({ key: 2 }, [ d.td({ key: 1 }, 'Table'), d.td({ key: 2 }, 'Data') ]),
                            d.tr({ key: 3 }, [ d.td({ key: 1 }, 'Table'), d.td({ key: 2 }, 'Data') ])
                        ])
                    ]))
                ]),

                d.h3({
                    key: 4,
                    className: 'no-flex'
                }, 'Footer')
            ]));
        },

        setHeight: function (e) {
            this.setState({
                height: e.target.value
            });
        },

        render: function () {
            return d.div({}, [
                d.div({
                    key: 'form',
                    className: 'container hidden-print'
                }, d.label({ key: 1 }, 'Section Content Height: ', d.input({
                    key: 2,
                    type: 'number',
                    min: 0,
                    step: 50,
                    value: this.state.height,
                    onChange: this.setHeight
                }))),

                d.div({ key: 'pgs' }, this.getPages())
            ]);
        }
    });

    var pdf = React.createFactory(PageDemo);

    var Demo = React.createClass({
        displayName: 'Demo',

        getInitialState: function () {
            return {
                sections: 1,
                pageWidth: 8.5,
                pageHeight: 11,
                dpi: 96
            };
        },

        handleSectionsChange: function (e) {
            this.setState({
                sections: e.target.value
            });
        },

        handleWidthChange: function (e) {
            var val = +e.target.value;
            if (typeof val === 'number' && !isNaN(val)) {
                this.setState({
                    pageWidth: Math.max(1, val)
                });
            }
        },
        handleHeightChange: function (e) {
            var val = +e.target.value;
            if (typeof val === 'number' && !isNaN(val)) {
                this.setState({
                    pageHeight: Math.max(1, val)
                });
            }
        },


        handleDpiChange: function (e) {
            var val = +e.target.value;
            if (typeof val === 'number' && !isNaN(val)) {
                this.setState({
                    dpi: Math.max(1, val)
                });
            }
        },
        getSections: function () {
            var sec = [];
            for (var i = 0; i < this.state.sections; i++) {
                sec.push(pdf({
                    key: i,
                    pageHeight: this.state.pageHeight,
                    pageWidth: this.state.pageWidth,
                    dpi: this.state.dpi
                }));
            }
            return sec;
        },

        render: function () {
            return d.div({}, [
                d.form({ key: 1, className: 'hidden-print' }, [
                    d.label({ key: 1, htmlFor: 'numSections' }, '# of sections: '),
                    d.input({
                        key: 2,
                        min: 1,
                        id: 'numSections',
                        type: 'number',
                        value: this.state.sections,
                        onChange: this.handleSectionsChange
                    }),
                    d.label({ key: 3, htmlFor: 'pageWidth' }, 'page width (in): '),
                    d.input({
                        key: 4,
                        min: 1,
                        step: 0.1,
                        id: 'pageWidth',
                        type: 'number',
                        value: this.state.pageWidth,
                        onChange: this.handleWidthChange
                    }),
                    d.label({ key: 5, htmlFor: 'pageHeight' }, 'page height (in): '),
                    d.input({
                        key: 6,
                        min: 1,
                        step: 0.1,
                        id: 'pageHeight',
                        type: 'number',
                        value: this.state.pageHeight,
                        onChange: this.handleHeightChange
                    }),

                    d.label({ key: 7, htmlFor: 'dpi' }, 'screen dpi: '),
                    d.input({
                        key: 8,
                        min: 0,
                        step: 4,
                        id: 'dpi',
                        type: 'number',
                        value: this.state.dpi,
                        onChange: this.handleDpiChange
                    }),
                    d.hr({ key: 'hr' })
                ]),

                d.div({ key: 'sec' }, this.getSections())
            ]);
        }
    });

    ReactDOM.render(React.createElement(Demo), document.getElementById('demo'));
</script>

</body>
</html>